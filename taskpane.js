/*! For license information please see taskpane.js.LICENSE.txt */
!function(){function e(e,n){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,n){if(e){if("string"==typeof e)return t(e,n);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?t(e,n):void 0}}(e))||n&&e&&"number"==typeof e.length){r&&(e=r);var o=0,a=function(){};return{s:a,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,i=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return i=e.done,e},e:function(e){s=!0,c=e},f:function(){try{i||null==r.return||r.return()}finally{if(s)throw c}}}}function t(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function n(){var e,t,o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",c=o.toStringTag||"@@toStringTag";function i(n,o,a,c){var i=o&&o.prototype instanceof u?o:u,f=Object.create(i.prototype);return r(f,"_invoke",function(n,r,o){var a,c,i,u=0,f=o||[],l=!1,p={p:0,n:0,v:e,a:m,f:m.bind(e,4),d:function(t,n){return a=t,c=0,i=e,p.n=n,s}};function m(n,r){for(c=n,i=r,t=0;!l&&u&&!o&&t<f.length;t++){var o,a=f[t],m=p.p,y=a[2];n>3?(o=y===r)&&(i=a[(c=a[4])?5:(c=3,3)],a[4]=a[5]=e):a[0]<=m&&((o=n<2&&m<a[1])?(c=0,p.v=r,p.n=a[1]):m<y&&(o=n<3||a[0]>r||r>y)&&(a[4]=n,a[5]=r,p.n=y,c=0))}if(o||n>1)return s;throw l=!0,r}return function(o,f,y){if(u>1)throw TypeError("Generator is already running");for(l&&1===f&&m(f,y),c=f,i=y;(t=c<2?e:i)||!l;){a||(c?c<3?(c>1&&(p.n=-1),m(c,i)):p.n=i:p.v=i);try{if(u=2,a){if(c||(o="next"),t=a[o]){if(!(t=t.call(a,i)))throw TypeError("iterator result is not an object");if(!t.done)return t;i=t.value,c<2&&(c=0)}else 1===c&&(t=a.return)&&t.call(a),c<2&&(i=TypeError("The iterator does not provide a '"+o+"' method"),c=1);a=e}else if((t=(l=p.n<0)?i:n.call(r,p))!==s)break}catch(t){a=e,c=1,i=t}finally{u=1}}return{value:t,done:l}}}(n,a,c),!0),f}var s={};function u(){}function f(){}function l(){}t=Object.getPrototypeOf;var p=[][a]?t(t([][a]())):(r(t={},a,function(){return this}),t),m=l.prototype=u.prototype=Object.create(p);function y(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,l):(e.__proto__=l,r(e,c,"GeneratorFunction")),e.prototype=Object.create(m),e}return f.prototype=l,r(m,"constructor",l),r(l,"constructor",f),f.displayName="GeneratorFunction",r(l,c,"GeneratorFunction"),r(m),r(m,c,"Generator"),r(m,a,function(){return this}),r(m,"toString",function(){return"[object Generator]"}),(n=function(){return{w:i,m:y}})()}function r(e,t,n,o){var a=Object.defineProperty;try{a({},"",{})}catch(e){a=0}r=function(e,t,n,o){function c(t,n){r(e,t,function(e){return this._invoke(t,n,e)})}t?a?a(e,t,{value:n,enumerable:!o,configurable:!o,writable:!o}):e[t]=n:(c("next",0),c("throw",1),c("return",2))},r(e,t,n,o)}function o(e,t,n,r,o,a,c){try{var i=e[a](c),s=i.value}catch(e){return void n(e)}i.done?t(s):Promise.resolve(s).then(r,o)}function a(e){return function(){var t=this,n=arguments;return new Promise(function(r,a){var c=e.apply(t,n);function i(e){o(c,r,a,i,s,"next",e)}function s(e){o(c,r,a,i,s,"throw",e)}i(void 0)})}}!function(){var t=null;function r(e){console.log("[Add-in]",e)}function o(){return c.apply(this,arguments)}function c(){return(c=a(n().m(function e(){return n().w(function(e){for(;;)if(0===e.n)return e.a(2,new Promise(function(e,t){r("Ouverture du dialogue d'auth..."),Office.context.ui.displayDialogAsync("https://art-errorless-roseann.ngrok-free.dev/auth.html",{height:60,width:40,displayInIframe:!1},function(n){if(n.status===Office.AsyncResultStatus.Failed)return t(new Error("Impossible d'ouvrir la fen√™tre d'auth"));var r=n.value;r.addEventHandler(Office.EventType.DialogMessageReceived,function(n){try{var o=JSON.parse(n.message);o.accessToken?e(o.accessToken):t(new Error(o.error||"Message inattendu depuis auth.html"))}catch(e){t(e)}finally{try{r.close()}catch(e){}}}),r.addEventHandler(Office.EventType.DialogEventReceived,function(e){t(new Error("Fen√™tre d'auth ferm√©e/annul√©e: "+JSON.stringify(e)));try{r.close()}catch(e){}})})}))},e)}))).apply(this,arguments)}function i(){return s.apply(this,arguments)}function s(){return(s=a(n().m(function e(){return n().w(function(e){for(;;)if(0===e.n)return e.a(2,new Promise(function(e,t){Office.context.mailbox.item.to.getAsync(function(n){if(n.status===Office.AsyncResultStatus.Succeeded){var r=(n.value||[]).map(function(e){return"string"==typeof e?e:e.emailAddress||e.address}).filter(Boolean);e(r)}else t(n.error||new Error("Impossible de lire les destinataires"))})}))},e)}))).apply(this,arguments)}function u(){return f.apply(this,arguments)}function f(){return(f=a(n().m(function e(){return n().w(function(e){for(;;)if(0===e.n)return e.a(2,new Promise(function(e,t){Office.context.mailbox.item.subject.getAsync(function(n){n.status===Office.AsyncResultStatus.Succeeded?e(n.value||"(Sans sujet)"):t(n.error||new Error("Impossible de lire le sujet du mail"))})}))},e)}))).apply(this,arguments)}function l(){return p.apply(this,arguments)}function p(){return(p=a(n().m(function e(){return n().w(function(e){for(;;)if(0===e.n)return e.a(2,new Promise(function(e,t){Office.context.mailbox.item.body.getAsync("html",function(n){n.status===Office.AsyncResultStatus.Succeeded?e(n.value||""):t(n.error||new Error("Impossible de lire le corps"))})}))},e)}))).apply(this,arguments)}function m(e,t){return y.apply(this,arguments)}function y(){return(y=a(n().m(function e(t,r){var o,a,c,i;return n().w(function(e){for(;;)switch(e.n){case 0:if(t){e.n=1;break}return e.a(2,[]);case 1:return o=Office.context.mailbox.convertToRestId(t,Office.MailboxEnums.RestVersion.v2_0),e.n=2,fetch("https://graph.microsoft.com/v1.0/me/messages/".concat(o,"/attachments"),{method:"GET",headers:{Authorization:"Bearer ".concat(r),"Content-Type":"application/json"}});case 2:if((a=e.v).ok){e.n=4;break}return e.n=3,a.text().catch(function(){return""});case 3:throw c=e.v,new Error("Graph error ".concat(a.status,": ").concat(c));case 4:return e.n=5,a.json();case 5:return i=e.v,e.a(2,(i.value||[]).filter(function(e){return"#microsoft.graph.fileAttachment"===e["@odata.type"]}).map(function(e){return{name:e.name,contentBytes:e.contentBytes,contentType:e.contentType||"application/octet-stream"}}))}},e)}))).apply(this,arguments)}function h(e,t,n,r){return d.apply(this,arguments)}function d(){return d=a(n().m(function e(t,r,o,a){var c,i,s,u=arguments;return n().w(function(e){for(;;)switch(e.n){case 0:return c={message:{subject:o||"(Sans sujet)",body:{contentType:"HTML",content:a||""},toRecipients:[{emailAddress:{address:r}}],attachments:(u.length>4&&void 0!==u[4]?u[4]:[]).map(function(e){return{"@odata.type":"#microsoft.graph.fileAttachment",name:e.name,contentBytes:e.contentBytes,contentType:e.contentType||"application/octet-stream"}})}},e.n=1,fetch("https://graph.microsoft.com/v1.0/me/sendMail",{method:"POST",headers:{Authorization:"Bearer ".concat(t),"Content-Type":"application/json"},body:JSON.stringify(c)});case 1:if((i=e.v).ok){e.n=3;break}return e.n=2,i.text().catch(function(){return""});case 2:throw s=e.v,new Error("Graph error ".concat(i.status,": ").concat(s));case 3:return e.a(2)}},e)})),d.apply(this,arguments)}function v(){return b.apply(this,arguments)}function b(){return(b=a(n().m(function e(){return n().w(function(e){for(;;)if(0===e.n)return e.a(2,new Promise(function(e,t){Office.context.mailbox.item.saveAsync(function(n){n.status===Office.AsyncResultStatus.Succeeded?e(n.value):t(n.error||new Error("Impossible de sauvegarder le draft"))})}))},e)}))).apply(this,arguments)}function g(e,t){return w.apply(this,arguments)}function w(){return w=a(n().m(function e(t,r){var o,a,c;return n().w(function(e){for(;;)switch(e.n){case 0:if(t){e.n=1;break}return e.a(2);case 1:return o=Office.context.mailbox.convertToRestId(t,Office.MailboxEnums.RestVersion.v2_0),e.n=2,fetch("https://graph.microsoft.com/v1.0/me/messages/".concat(o),{method:"DELETE",headers:{Authorization:"Bearer ".concat(r)}});case 2:if((a=e.v).ok){e.n=4;break}return e.n=3,a.text().catch(function(){return""});case 3:c=e.v,console.error("Erreur suppression draft:",c),e.n=5;break;case 4:console.log("Draft supprim√© avec succ√®s");case 5:return e.a(2)}},e)})),w.apply(this,arguments)}function O(){return E.apply(this,arguments)}function E(){return(E=a(n().m(function a(){var c,s,f,p,y,d,b,w,O,E,k,x,A,T;return n().w(function(n){for(;;)switch(n.p=n.n){case 0:return n.p=0,r("D√©marrage de l'action..."),c=null,n.p=1,n.n=2,v();case 2:c=n.v,console.log("Draft sauvegard√©, ID =",c),n.n=4;break;case 3:n.p=3,E=n.v,console.warn("Impossible de sauvegarder le draft :",E);case 4:if(t){n.n=6;break}return r("Pas de token ‚Äî ouverture auth..."),n.n=5,o();case 5:t=n.v;case 6:if(t){n.n=7;break}throw new Error("Token introuvable apr√®s auth");case 7:return n.n=8,i();case 8:if((s=n.v)&&0!==s.length){n.n=9;break}return Office.context.mailbox.item.notificationMessages.replaceAsync("noRecipients",{type:"errorMessage",message:"‚ö†Ô∏è Aucun destinataire trouv√©."}),n.a(2);case 9:return n.n=10,u();case 10:return f=n.v,n.n=11,l();case 11:if(p=n.v,y=[],!c){n.n=15;break}return n.p=12,n.n=13,m(c,t);case 13:y=n.v,console.log("üìé ".concat(y.length," pi√®ce(s) jointe(s) r√©cup√©r√©e(s)")),n.n=15;break;case 14:n.p=14,k=n.v,console.warn("Impossible de r√©cup√©rer les pi√®ces jointes :",k);case 15:d=0,b=e(s),n.p=16,b.s();case 17:if((w=b.n()).done){n.n=22;break}return O=w.value,n.p=18,r("Envoi √† ".concat(O,"...")),n.n=19,h(t,O,f,p,y);case 19:d++,n.n=21;break;case 20:n.p=20,x=n.v,console.error("Erreur envoi:",x),r("Erreur envoi ".concat(O,": ").concat(x.message||x));case 21:n.n=17;break;case 22:n.n=24;break;case 23:n.p=23,A=n.v,b.e(A);case 24:return n.p=24,b.f(),n.f(24);case 25:if(!c||d!==s.length){n.n=26;break}return n.n=26,g(c,t);case 26:Office.context.mailbox.item.notificationMessages.replaceAsync("successMsg",{type:"informationalMessage",message:"‚úÖ ".concat(d," email(s) envoy√©s individuellement"),icon:"icon16",persistent:!1}),r("Termin√©."),n.n=28;break;case 27:n.p=27,T=n.v,console.error("Erreur run:",T),Office.context.mailbox.item.notificationMessages.replaceAsync("errorMsg",{type:"errorMessage",message:"‚ùå Une erreur est survenue. Voir console."});case 28:return n.a(2)}},a,null,[[18,20],[16,23,24,25],[12,14],[1,3],[0,27]])}))).apply(this,arguments)}Office.onReady(function(){Office.actions.associate("run",O)})}()}();
//# sourceMappingURL=taskpane.js.map